<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>QuickSort Demo</title>
  <style>
    :root {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      line-height: 1.4
    }

    body {
      max-width: 900px;
      margin: 36px auto;
      padding: 20px;
      color: #111
    }

    h1 {
      margin: 0 0 12px;
      font-size: 20px
    }

    .card {
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 16px;
      background: #fff
    }

    label {
      display: block;
      margin: 12px 0 6px;
      font-weight: 600
    }

    input[type="text"],
    textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 6px
    }

    .row {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-top: 12px
    }

    button {
      padding: 8px 12px;
      border-radius: 6px;
      border: 0;
      background: #0366d6;
      color: #fff;
      cursor: pointer
    }

    button:disabled {
      opacity: .6;
      cursor: not-allowed
    }

    pre {
      background: #f7f7f7;
      padding: 12px;
      border-radius: 6px;
      overflow: auto;
      max-height: 240px;
    }

    .meta {
      font-size: 12px;
      color: #666;
      margin-top: 8px
    }

    .meta.error {
      color: #a00;
    }

    .benchmark-results {
      margin-top: 20px;
      border-top: 1px solid #ccc;
      padding-top: 10px;
    }

    .benchmark-results h2 {
      font-size: 18px;
      margin-bottom: 10px;
    }

    .benchmark-results pre {
      max-height: 200px;
      overflow-y: auto;
    }
  </style>
</head>

<body>
  <main class="card">
    <h1>QuickSort Demo</h1>

    <label for="inputArray">Enter numbers (comma, space or newline separated) or a JSON array</label>
    <textarea id="inputArray" rows="4" placeholder="e.g. 3, 1, 4, 1, 5, 9 or [3,1,4]"></textarea>

    <label><input type="checkbox" id="inPlace"> Mutate input array (in-place)</label>

    <div class="row">
      <select id="pivotSelect" title="pivot strategy">
        <option value="random">Pivot: random</option>
        <option value="median3">Pivot: median-of-3</option>
        <option value="first">Pivot: first</option>
        <option value="last">Pivot: last</option>
      </select>
      <button id="sortBtn">Sort</button>
      <button id="clearBtn" style="background:#e0e0e0;color:#111">Clear</button>
    </div>

    <div class="row">
      <label for="minRange">Min Range:</label>
      <input type="number" id="minRange" value="0" />
      <label for="maxRange">Max Range:</label>
      <input type="number" id="maxRange" value="100" />
      <button id="generateBtn">Generate Random Numbers</button>
    </div>

    <div class="meta" id="meta"></div>

    <h2 style="margin-top:18px;font-size:16px">Result</h2>
    <div>
      <strong>Original:</strong>
      <pre id="original">[]</pre>
    </div>
    <div style="margin-top:8px">
      <strong>Sorted:</strong>
      <pre id="sorted">[]</pre>
    </div>

    <div class="benchmark-results" id="benchmarkResults" style="display:none;">
      <h2>Benchmark Results</h2>
      <pre id="benchmarkOutput"></pre>
    </div>
  </main>

  <script>
    // Simple non-mutating QuickSort with options (3-way partition + pivot strategies)
    function quickSort(arr, { comparator, inPlace = false, pivot = 'random' } = {}) {
      if (!Array.isArray(arr)) throw new TypeError('quickSort expects an array');

      const a = inPlace ? arr : arr.slice();
      const n = a.length;
      if (n <= 1) return a;

      const cmp = typeof comparator === 'function'
        ? comparator
        : (x, y) => (x < y ? -1 : x > y ? 1 : 0);

      const swap = (i, j) => {
        if (i === j) return;
        const t = a[i]; a[i] = a[j]; a[j] = t;
      };

      const choosePivotIndex = (lo, hi) => {
        if (lo >= hi) return lo;
        if (pivot === 'first') return lo;
        if (pivot === 'last') return hi;
        if (pivot === 'median3') {
          const mid = lo + ((hi - lo) >> 1);
          const A = a[lo], B = a[mid], C = a[hi];
          if (cmp(A, B) <= 0) {
            if (cmp(B, C) <= 0) return mid;
            if (cmp(A, C) <= 0) return hi;
            return lo;
          } else {
            if (cmp(A, C) <= 0) return lo;
            if (cmp(B, C) <= 0) return hi;
            return mid;
          }
        }
        return lo + Math.floor(Math.random() * (hi - lo + 1));
      };

      const stack = [[0, n - 1]];
      while (stack.length) {
        const [lo, hi] = stack.pop();
        if (lo >= hi) continue;

        const p = choosePivotIndex(lo, hi);
        const pivotVal = a[p];

        let i = lo, lt = lo, gt = hi;
        while (i <= gt) {
          const r = cmp(a[i], pivotVal);
          if (r < 0) { swap(lt++, i++); }
          else if (r > 0) { swap(i, gt--); }
          else { i++; }
        }

        const leftSize = lt - lo;
        const rightSize = hi - gt;
        if (leftSize < rightSize) {
          if (gt + 1 < hi) stack.push([gt + 1, hi]);
          if (lo < lt - 1) stack.push([lo, lt - 1]);
        } else {
          if (lo < lt - 1) stack.push([lo, lt - 1]);
          if (gt + 1 < hi) stack.push([gt + 1, hi]);
        }
      }

      return a;
    }

    // UI wiring
    const inputEl = document.getElementById('inputArray');
    const sortBtn = document.getElementById('sortBtn');
    const clearBtn = document.getElementById('clearBtn');
    const originalPre = document.getElementById('original');
    const sortedPre = document.getElementById('sorted');
    const meta = document.getElementById('meta');
    const inPlaceCheck = document.getElementById('inPlace');
    const pivotSelect = document.getElementById('pivotSelect');
    const benchmarkResults = document.getElementById('benchmarkResults');
    const benchmarkOutput = document.getElementById('benchmarkOutput');
    const minRangeInput = document.getElementById('minRange');
    const maxRangeInput = document.getElementById('maxRange');
    const generateBtn = document.getElementById('generateBtn');

    function showMeta(msg, isError = false) {
      meta.textContent = msg || '';
      meta.classList.toggle('error', !!isError);
    }

    function showResult(orig, sorted, timeMs) {
      originalPre.textContent = JSON.stringify(orig, null, 0);
      sortedPre.textContent = JSON.stringify(sorted, null, 0);
      showMeta(`Items: ${orig.length} • Time: ${timeMs.toFixed(3)} ms • Pivot: ${pivotSelect.value} • inPlace: ${inPlaceCheck.checked}`);
    }

    function showError(msg) {
      originalPre.textContent = '[]';
      sortedPre.textContent = '[]';
      showMeta('Error: ' + msg, true);
    }

    function parseInput(text) {
      if (!text || !text.trim()) return [];
      const s = text.trim();
      if (s[0] === '[') {
        try {
          const parsed = JSON.parse(s);
          if (!Array.isArray(parsed)) throw new Error('JSON must be an array');
          return parsed.map((v, idx) => {
            if (typeof v === 'number') {
              if (!isFinite(v)) throw new Error(`Invalid numeric value at index ${idx}: ${v}`);
              return v;
            }
            const n = Number(v);
            if (Number.isNaN(n) || !isFinite(n)) throw new Error(`Invalid numeric value at index ${idx}: ${v}`);
            return n;
          });
        } catch (e) {
          throw new Error('Invalid JSON array: ' + (e && e.message));
        }
      }

      const parts = text.split(/[\s,]+/).filter(Boolean);
      const nums = parts.map((s, idx) => {
        const v = Number(s);
        if (Number.isNaN(v) || !isFinite(v)) throw new Error('Invalid number token: "' + s + '" at position ' + (idx + 1));
        return v;
      });
      return nums;
    }

    async function runSort() {
      sortBtn.disabled = true;
      clearBtn.disabled = true;
      showMeta('Preparing...', false);
      try {
        let arr;
        try {
          arr = parseInput(inputEl.value);
        } catch (e) {
          showError(e.message);
          return;
        }

        if (arr.length === 0) {
          showResult([], [], 0);
          return;
        }

        const inPlace = inPlaceCheck.checked;
        const pivot = pivotSelect.value;

        const origCopy = arr.slice();

        showMeta('Sorting...', false);
        const t0 = performance.now();
        let sorted;
        try {
          sorted = quickSort(arr, { inPlace, pivot, comparator: (a, b) => a - b });
        } catch (err) {
          showError(err && err.message ? err.message : String(err));
          return;
        }
        const t1 = performance.now();

        showResult(origCopy, sorted, t1 - t0);
      } finally {
        sortBtn.disabled = false;
        clearBtn.disabled = false;
      }
    }

    function generateRandomNumbers(min, max, count) {
      const arr = [];
      for (let i = 0; i < count; i++) {
        arr.push(Math.floor(Math.random() * (max - min + 1)) + min);
      }
      return arr;
    }

    generateBtn.addEventListener('click', () => {
      const min = parseInt(minRangeInput.value);
      const max = parseInt(maxRangeInput.value);
      if (min >= max) {
        showError('Min must be less than Max.');
        return;
      }
      const randomNumbers = generateRandomNumbers(min, max, 10); // Generate 10 random numbers
      inputEl.value = randomNumbers.join(', ');
      showMeta(`Generated random numbers: ${randomNumbers.join(', ')}`);
    });

    sortBtn.addEventListener('click', () => {
      setTimeout(runSort, 0);
    });

    clearBtn.addEventListener('click', () => {
      inputEl.value = '';
      originalPre.textContent = '[]';
      sortedPre.textContent = '[]';
      showMeta('');
    });

    // Prefill with example
    inputEl.value = '3, 6, 1, 5, 2, 4';
  </script>
</body>

</html>